{% load static %}
{% include 'components/navbar.html' %}

<section class="mx-auto max-w-7xl py-20 grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Sol kısım -->
  <div class="lg:col-span-1 flex flex-col gap-8">
    <!-- Avatar ve isim -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6 flex flex-col relative items-center">
      <div class="relative w-40 h-40 rounded-full overflow-hidden border-4 border-main">
        <img src="{{ profile.get_avatar_url }}" alt="{{ user.get_full_name }}" class="w-full h-full object-cover">
      </div>
      <p class="text-gray-400 text-center pt-4">@{{ user.username }}</p>
      <h2 class="text-4xl text-center font-bold my-4 leading-normal tracking-[0.8px] text-white">{{ user.get_full_name|default:user.username }}</h2>
      <p><span class="text-gray-400 text-left">Email:</span> <span>{{ user.email }}</span></p>
      <p><span class="text-gray-400 text-left">Üyelik Tarihi:</span> <span>{{ user.date_joined|date:"d M Y" }}</span></p>
      <div class="flex items-end justify-end pt-6 space-x-2">
        <button onclick="toggleEditForm()" class="bg-black-20 border-main border px-4 py-2 rounded-full hover:bg-main hover:text-black transition">Düzenle</button>
      </div>
      {% if profile.bio %}
        <p class="text-gray-300 text-center mt-4 font-extralight tracking-[0.8px]">{{ profile.bio }}</p>
      {% endif %}
    </div>

    <!-- Rozetler -->
<div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6">
  <h3 class="text-3xl font-semibold mb-6 leading-normal tracking-[0.8px] text-white text-center">Rozetler</h3>

  <!-- Rozet Grid -->
  <div class="grid grid-cols-3 gap-4">
    <!-- İlk Egzersiz Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg">
      <!-- icon -->
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 17l-4.243 2.243.81-4.716L5 10.757l4.9-.716L12 6l2.1 4.041 4.9.716-3.567 3.77.81 4.716z"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">İlk Adım</div>
      <div class="text-xs text-gray-200 text-center">İlk egzersizi tamamla</div>
    </div>

    <!-- Hafıza Uzmanı Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4m6 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">Hafıza Uzmanı</div>
      <div class="text-xs text-gray-200 text-center">10 hafıza egzersizi</div>
    </div>

    <!-- Kelime Köprüsü Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h4a1 1 0 011 1v8a1 1 0 01-1 1H3m14-10h4a1 1 0 011 1v8a1 1 0 01-1 1h-4M7 12h10"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">Köprü Kurucusu</div>
      <div class="text-xs text-gray-200 text-center">5 kelime köprüsü</div>
    </div>

    <!-- Problem Çözücü Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3v2.25m4.5-2.25v2.25M4.5 9.75h15M3 14.25h18M9.75 21v-2.25m4.5 2.25v-2.25"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">Problem Çözücü</div>
      <div class="text-xs text-gray-200 text-center">Problem zinciri uzmanı</div>
    </div>

    <!-- Mükemmeliyetçi Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 3l-4 7 10 11 10-11-4-7H6z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M2 10h20"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">Mükemmeliyetçi</div>
      <div class="text-xs text-gray-200 text-center">Ortalama 9+ puan</div>
    </div>

    <!-- Sabırlı Öğrenci Rozeti -->
    <div class="flex flex-col items-center p-4 bg-second rounded-xl shadow-lg opacity-50">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mb-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div class="text-xs font-semibold text-center text-white">Sabırlı Öğrenci</div>
      <div class="text-xs text-gray-200 text-center">30 gün üst üste</div>
    </div>
  </div>

  <p class="text-center text-gray-400 text-sm mt-4 font-extralight">
    Egzersizleri tamamlayarak yeni rozetler kazan!
  </p>
</div>


    <!-- İstatistikler ve Başarılar -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6 flex flex-col items-center">
      <h3 class="text-3xl font-semibold mb-4 leading-normal tracking-[0.8px] text-white">Başarılar & İstatistikler</h3>
      
      <!-- Ana İstatistikler -->
      <div class="grid grid-cols-3 gap-4 w-full mb-6">
        <div class="text-center p-4 bg-gray-800 rounded-lg">
          <div class="text-2xl font-bold text-main">{{ profile.total_exercises_completed }}</div>
          <div class="text-xs text-gray-400">Toplam Egzersiz</div>
        </div>
        <div class="text-center p-4 bg-gray-800 rounded-lg">
          <div class="text-2xl font-bold text-main">{{ profile.average_score|floatformat:1 }}</div>
          <div class="text-xs text-gray-400">Ortalama Puan</div>
        </div>
        <div class="text-center p-4 bg-gray-800 rounded-lg">
          <div class="text-2xl font-bold text-main">{{ profile.best_score|floatformat:1 }}</div>
          <div class="text-xs text-gray-400">En İyi Puan</div>
        </div>
      </div>
      
      <p class="font-extralight text-gray-300 text-md tracking-[0.8px] text-center">
        {% if profile.total_exercises_completed > 0 %}
          Bugüne kadar {{ profile.total_exercises_completed }} egzersiz tamamladın ve ortalama {{ profile.average_score|floatformat:1 }} puan aldın.
        {% else %}
          Henüz hiç egzersiz yapmadın. Hemen başlamak için aşağıdaki egzersizlere göz at!
        {% endif %}
      </p>
    </div>
  </div>

  <!-- Sağ kısım -->
  <div class="lg:col-span-2 flex flex-col gap-8">
    
    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-600 text-white{% elif message.tags == 'error' %}bg-red-600 text-white{% else %}bg-blue-600 text-white{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Kullanıcı bilgileri -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6">
      <h3 class="text-3xl font-semibold mb-8 leading-normal tracking-[0.8px] text-white">Yapay Zeka'dan Günün Beyin Sağlığı Tavsiyesi</h3>
      <div id="daily-tip-content" class="text-white text-lg leading-relaxed min-h-[60px] flex items-center">
        <div class="w-full text-center">
          <div class="inline-flex items-center">
            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-300 mr-2"></div>
            <span>Yükleniyor...</span>
          </div>
        </div>
      </div>
      <div class="mt-3 text-sm text-blue-200/70 flex items-center">
        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        Bu tavsiye günlük olarak yenilenir
      </div>
    </div>

    <!-- Egzersiz geçmişi -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6">
      <h3 class="text-3xl font-semibold mb-4 leading-normal tracking-[0.8px] text-white">Egzersiz Geçmişi</h3>

      <!-- Tab butonları -->
      <div class="flex flex-wrap gap-4 my-8">
        <button data-target="hafiza"
          class="tab-btn px-6 py-3 rounded-full border border-main text-white hover:bg-main/20 transition active bg-main/20">
          Hafıza Egzersizleri
        </button>
        <button data-target="kelime"
          class="tab-btn px-6 py-3 rounded-full border border-main text-white hover:bg-main/20 transition">
          Kelime Köprüsü
        </button>
        <button data-target="problem"
          class="tab-btn px-6 py-3 rounded-full border border-main text-white hover:bg-main/20 transition">
          Problem Zinciri
        </button>
      </div>

      <!-- Tab içerikleri -->
      <div id="hafiza" class="tab-content font-extralight text-gray-300 text-md tracking-[0.8px] text-justify">
        <div class="flex items-center space-x-3 mb-4">
          <img src="{% static 'img/frontal-active.svg' %}" alt="Memory" class="w-8 h-8">
          <div>
            <p class="mb-2">Toplam <span class="text-white font-semibold">{{ profile.memory_exercises_completed }}</span> hafıza egzersizi tamamladın.</p>
            <p>Bu egzersizler, kısa süreli belleğini güçlendirdi ve bilgileri hızlı hatırlama yeteneğini artırdı.</p>
          </div>
        </div>
        <div class="mt-4">
          <a href="{% url 'ai:memory_test' %}" class="inline-flex items-center text-main hover:text-main/80 font-semibold">
            Egzersize Git →
          </a>
        </div>
      </div>

      <div id="kelime" class="tab-content hidden font-extralight text-gray-300 text-md tracking-[0.8px] text-justify">
        <div class="flex items-center space-x-3 mb-4">
          <img src="{% static 'img/temporal-active.svg' %}" alt="Word Bridge" class="w-8 h-8">
          <div>
            <p class="mb-2">Toplam <span class="text-white font-semibold">{{ profile.word_bridge_exercises_completed }}</span> kelime köprüsü egzersizi tamamladın.</p>
            <p>Farklı kelimeler arasında bağlantı kurarak yaratıcılığını ve dil becerinizi geliştirdin.</p>
          </div>
        </div>
        <div class="mt-4">
          <a href="{% url 'ai:word_bridge_test' %}" class="inline-flex items-center text-main hover:text-main/80 font-semibold">
            Egzersize Git →
          </a>
        </div>
      </div>

      <div id="problem" class="tab-content hidden font-extralight text-gray-300 text-md tracking-[0.8px] text-justify">
        <div class="flex items-center space-x-3 mb-4">
          <img src="{% static 'img/parietal-active.svg' %}" alt="Problem Chain" class="w-8 h-8">
          <div>
            <p class="mb-2">Toplam <span class="text-white font-semibold">{{ profile.problem_chain_exercises_completed }}</span> problem zinciri egzersizi tamamladın.</p>
            <p>Karmaşık problemleri adım adım çözerek analitik düşünme becerinizi geliştirdin.</p>
          </div>
        </div>
        <div class="mt-4">
          <a href="{% url 'ai:problem_chain_test' %}" class="inline-flex items-center text-main hover:text-main/80 font-semibold">
            Egzersize Git →
          </a>
        </div>
      </div>
    </div>

    <!-- Beyin Sağlığı Analizi -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-3xl font-semibold leading-normal tracking-[0.8px] text-white">Beyin Sağlığı Analizi</h3>
        <div class="flex items-center space-x-3">
          <button id="infoButton" class="text-gray-400 hover:text-main transition-colors" title="Bu analiz nasıl çalışır?">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </button>
          <button id="refreshAnalysis" class="text-sm bg-main/20 hover:bg-main/30 text-main px-4 py-2 rounded-full transition">
            Güncelle
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div id="analysisLoading" class="hidden">
        <div class="flex items-center justify-center py-8">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-main"></div>
          <span class="ml-3 text-gray-300">Analiz hesaplanıyor...</span>
        </div>
      </div>

      <!-- Main Score Display -->
      <div id="analysisContent">
        <div class="text-center mb-8">
          <div class="relative w-32 h-32 mx-auto">
            <!-- Progress Circle -->
            <svg class="transform -rotate-90 w-32 h-32">
              <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="none" class="text-gray-700" />
              <circle id="progressCircle" cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="none" 
                      class="text-main transition-all duration-500" stroke-linecap="round" 
                      stroke-dasharray="351.86" stroke-dashoffset="351.86" />
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div id="brainHealthScore" class="text-3xl font-bold text-white">-</div>
                <div class="text-sm text-gray-400">/ 10</div>
              </div>
            </div>
          </div>
          <p id="analysisMessage" class="text-gray-300 mt-4 text-center">Analiz hesaplanıyor...</p>
        </div>

        <!-- Score Breakdown -->
        <div id="scoreBreakdown" class="grid grid-cols-2 gap-4 mb-6 hidden">
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-300 text-sm">Sıklık</span>
              <span id="frequencyScore" class="text-main font-semibold">-</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div id="frequencyBar" class="bg-main h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-300 text-sm">Performans</span>
              <span id="performanceScore" class="text-main font-semibold">-</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div id="performanceBar" class="bg-main h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-300 text-sm">Tutarlılık</span>
              <span id="consistencyScore" class="text-main font-semibold">-</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div id="consistencyBar" class="bg-main h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="bg-gray-800 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-300 text-sm">Gelişim</span>
              <span id="improvementScore" class="text-main font-semibold">-</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div id="improvementBar" class="bg-main h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Exercise Distribution -->
        <div id="exerciseDistribution" class="hidden">
          <h4 class="text-lg font-semibold text-white mb-4">Egzersiz Dağılımı</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-gray-300">Hafıza</span>
              <div class="flex items-center space-x-2">
                <div class="w-20 bg-gray-700 rounded-full h-2">
                  <div id="memoryBar" class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <span id="memoryPercent" class="text-sm text-gray-400 w-8">0%</span>
              </div>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-gray-300">Kelime</span>
              <div class="flex items-center space-x-2">
                <div class="w-20 bg-gray-700 rounded-full h-2">
                  <div id="wordBridgeBar" class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <span id="wordBridgePercent" class="text-sm text-gray-400 w-8">0%</span>
              </div>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-gray-300">Problem</span>
              <div class="flex items-center space-x-2">
                <div class="w-20 bg-gray-700 rounded-full h-2">
                  <div id="problemChainBar" class="bg-purple-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <span id="problemChainPercent" class="text-sm text-gray-400 w-8">0%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Bonuses -->
        <div id="bonusInfo" class="mt-6 hidden">
          <h4 class="text-lg font-semibold text-white mb-4">Bonus Skorlar</h4>
          <div class="grid grid-cols-3 gap-3 text-center">
            <div class="bg-gray-800 rounded-lg p-3">
              <div id="varietyBonus" class="text-yellow-400 font-semibold">+0.0</div>
              <div class="text-xs text-gray-400">Çeşitlilik</div>
            </div>
            <div class="bg-gray-800 rounded-lg p-3">
              <div id="difficultyBonus" class="text-red-400 font-semibold">+0.0</div>
              <div class="text-xs text-gray-400">Zorluk</div>
            </div>
            <div class="bg-gray-800 rounded-lg p-3">
              <div id="streakBonus" class="text-green-400 font-semibold">+0.0</div>
              <div class="text-xs text-gray-400">Seri</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Form (Hidden by default) -->
    <div id="editForm" class="hidden border border-main bg-black bg-opacity-20 rounded-2xl p-6">
      <h3 class="text-3xl font-semibold mb-8 leading-normal tracking-[0.8px] text-white">Profil Bilgilerini Düzenle</h3>
      
      <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Avatar -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Profil Fotoğrafı</label>
            {{ form.avatar }}
            {% if form.avatar.errors %}
              <p class="mt-1 text-sm text-red-400">{{ form.avatar.errors.0 }}</p>
            {% endif %}
          </div>

        <!-- Bio -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Hakkında</label>
          {{ form.bio }}
          {% if form.bio.errors %}
            <p class="mt-1 text-sm text-red-400">{{ form.bio.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- Email Notifications -->
        <div class="flex items-center space-x-3">
          {{ form.email_notifications }}
          <label class="text-sm text-gray-300">Email bildirimleri al</label>
        </div>

        <!-- Submit Buttons -->
        <div class="flex space-x-4">
          <button 
            type="submit" 
            class="bg-main hover:bg-main/90 text-black font-semibold py-2 px-6 rounded-full transition-colors"
          >
            Değişiklikleri Kaydet
          </button>
          <button 
            type="button" 
            onclick="toggleEditForm()"
            class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-full transition-colors"
          >
            İptal
          </button>
        </div>
      </form>
    </div>

    <!-- Son Aktiviteler -->
    <div class="border border-main bg-black bg-opacity-20 rounded-2xl p-6">
      <h3 class="text-3xl font-semibold mb-6 leading-normal tracking-[0.8px] text-white">Son Aktiviteler</h3>
      
      <div class="space-y-4 font-extralight text-gray-300 text-md tracking-[0.8px]">
        <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
          <div class="w-2 h-2 bg-main rounded-full"></div>
          <div class="flex-grow">
            <p class="text-white">Profil oluşturuldu</p>
            <p class="text-gray-400 text-sm">{{ profile.created_at|date:"d M Y H:i" }}</p>
          </div>
        </div>
        
        {% if profile.total_exercises_completed > 0 %}
          <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
            <div class="flex-grow">
              <p class="text-white">{{ profile.total_exercises_completed }} egzersiz tamamlandı</p>
              <p class="text-gray-400 text-sm">Son güncelleme: {{ profile.updated_at|date:"d M Y H:i" }}</p>
            </div>
          </div>
        {% endif %}
        
        {% if profile.memory_exercises_completed > 0 %}
          <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
            <div class="flex-grow">
              <p class="text-white">{{ profile.memory_exercises_completed }} hafıza egzersizi tamamlandı</p>
              <p class="text-gray-400 text-sm">Hafıza becerin gelişiyor</p>
            </div>
          </div>
        {% endif %}
        
        {% if profile.word_bridge_exercises_completed > 0 %}
          <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
            <div class="flex-grow">
              <p class="text-white">{{ profile.word_bridge_exercises_completed }} kelime köprüsü egzersizi tamamlandı</p>
              <p class="text-gray-400 text-sm">Yaratıcılığın artıyor</p>
            </div>
          </div>
        {% endif %}
        
        {% if profile.problem_chain_exercises_completed > 0 %}
          <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
            <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
            <div class="flex-grow">
              <p class="text-white">{{ profile.problem_chain_exercises_completed }} problem zinciri egzersizi tamamlandı</p>
              <p class="text-gray-400 text-sm">Analitik düşünmen güçleniyor</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- Beyin Sağlığı Analizi Açıklama Modal -->
<div id="analysisModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
  <div class="bg-gray-900 rounded-2xl border border-main max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <!-- Modal Header -->
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-white flex items-center">
          <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Beyin Sağlığı Analizi Nasıl Hesaplanır?
        </h3>
        <button id="closeModal" class="text-gray-400 hover:text-white transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="space-y-6 text-gray-300">
        <!-- Genel Açıklama -->
        <div>
          <p class="leading-relaxed">
            Bu analiz, egzersiz performansınızı bilimsel metriklerle değerlendirerek beyin sağlığınızı <span class="text-main font-semibold">0-10 arası</span> puanlar. 
            Son <span class="text-main font-semibold">7 günlük</span> aktiviteniz baz alınarak hesaplanır ve <span class="text-main font-semibold">4 saatte bir</span> güncellenir.
          </p>
        </div>

        <!-- Puan Bileşenleri -->
        <div>
          <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Puan Bileşenleri
          </h4>
          <div class="space-y-4">
            <div class="flex items-start space-x-3 p-3 bg-gray-800 rounded-lg">
              <div class="text-blue-400 font-bold">30%</div>
              <div>
                <div class="font-semibold text-white flex items-center">
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                  Sıklık
                </div>
                <div class="text-sm">Günlük egzersiz yapma oranınız. Her gün yaparsanız maksimum puan alırsınız.</div>
              </div>
            </div>
            
            <div class="flex items-start space-x-3 p-3 bg-gray-800 rounded-lg">
              <div class="text-green-400 font-bold">40%</div>
              <div>
                <div class="font-semibold text-white flex items-center">
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9.5 7.707 6.621a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0z" clip-rule="evenodd"/>
                  </svg>
                  Performans
                </div>
                <div class="text-sm">Egzersizlerdeki ortalama skorunuz. En yüksek ağırlığa sahip faktör.</div>
              </div>
            </div>
            
            <div class="flex items-start space-x-3 p-3 bg-gray-800 rounded-lg">
              <div class="text-purple-400 font-bold">20%</div>
              <div>
                <div class="font-semibold text-white flex items-center">
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
                  </svg>
                  Tutarlılık
                </div>
                <div class="text-sm">Skorlarınızın istikrarlı olması. Sürekli benzer performans göstermeniz değerlidir.</div>
              </div>
            </div>
            
            <div class="flex items-start space-x-3 p-3 bg-gray-800 rounded-lg">
              <div class="text-yellow-400 font-bold">10%</div>
              <div>
                <div class="font-semibold text-white flex items-center">
                  <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                  </svg>
                  Gelişim
                </div>
                <div class="text-sm">Zaman içindeki ilerlemeniz. Skorlarınız artıyorsa bonus puan alırsınız.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bonus Sistem -->
        <div>
          <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.856.048l-1.85-3.7-1.85 3.7a1 1 0 01-1.856-.048L4.146 12.8.793 10.866a1 1 0 010-1.732L4.146 7.2l1.179-4.456A1 1 0 016.292 2.744L8.142 6.444 10.855 2.744A1 1 0 0112 2z" clip-rule="evenodd"/>
            </svg>
            Bonus Sistem
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="p-3 bg-gray-800 rounded-lg text-center">
              <div class="mb-2 flex justify-center">
                <svg class="w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </div>
              <div class="font-semibold text-white text-sm">Çeşitlilik</div>
              <div class="text-xs">Farklı egzersiz türleri yapma</div>
            </div>
            
            <div class="p-3 bg-gray-800 rounded-lg text-center">
              <div class="mb-2 flex justify-center">
                <svg class="w-6 h-6 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="font-semibold text-white text-sm">Zorluk</div>
              <div class="text-xs">Zor seviye egzersizler tercih etme</div>
            </div>
            
            <div class="p-3 bg-gray-800 rounded-lg text-center">
              <div class="mb-2 flex justify-center">
                <svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="font-semibold text-white text-sm">Seri</div>
              <div class="text-xs">Ardışık günlerde egzersiz yapma</div>
            </div>
          </div>
        </div>

        <!-- Skor Anlamları -->
        <div>
          <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            Skor Seviyeleri
          </h4>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-2 bg-green-900/30 rounded-lg border border-green-700">
              <span class="font-semibold text-green-300">8.5 - 10.0</span>
              <span class="text-green-100 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                Mükemmel! Beyin sağlığın harika durumda
              </span>
            </div>
            
            <div class="flex items-center justify-between p-2 bg-blue-900/30 rounded-lg border border-blue-700">
              <span class="font-semibold text-blue-300">7.0 - 8.4</span>
              <span class="text-blue-100 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Harika! Düzenli egzersizlerin meyve veriyor
              </span>
            </div>
            
            <div class="flex items-center justify-between p-2 bg-yellow-900/30 rounded-lg border border-yellow-700">
              <span class="font-semibold text-yellow-300">5.5 - 6.9</span>
              <span class="text-yellow-100 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
                </svg>
                İyi gidiyorsun! Biraz daha düzenli ol
              </span>
            </div>
            
            <div class="flex items-center justify-between p-2 bg-orange-900/30 rounded-lg border border-orange-700">
              <span class="font-semibold text-orange-300">0 - 5.4</span>
              <span class="text-orange-100 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
                Daha fazla egzersiz yaparak gelişebilirsin
              </span>
            </div>
          </div>
        </div>

        <!-- Önemli Not -->
        <div class="bg-main/10 border border-main/30 rounded-lg p-4">
          <div class="flex items-start space-x-3">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 text-main mt-0.5 flex-shrink-0">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <div class="font-semibold text-main mb-1 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                Önemli Not
              </div>
              <div class="text-sm">En az <span class="text-main font-semibold">5 egzersiz</span> tamamladıktan sonra analiz görüntülenir. Sistem her 4 saatte bir otomatik güncellenir.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="mt-8 text-center">
        <button id="closeModalBtn" class="bg-main hover:bg-main/90 text-black font-semibold px-6 py-2 rounded-full transition-colors">
          Anladım!
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Tab sistemi
  const tabs = document.querySelectorAll('.tab-btn');
  const contents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      // aktif butonu değiştir
      tabs.forEach(t => t.classList.remove('active', 'bg-main/20'));
      tab.classList.add('active', 'bg-main/20');

      // içerikleri değiştir
      const target = tab.getAttribute('data-target');
      contents.forEach(c => {
        if (c.id === target) {
          c.classList.remove('hidden');
        } else {
          c.classList.add('hidden');
        }
      });
    });
  });

  // Edit form toggle
  function toggleEditForm() {
    const editForm = document.getElementById('editForm');
    editForm.classList.toggle('hidden');
    
    // Scroll to form if opening
    if (!editForm.classList.contains('hidden')) {
      editForm.scrollIntoView({ behavior: 'smooth' });
    }
  }

  // Brain Health Analytics
  class BrainHealthAnalytics {
    constructor() {
      this.loadingElement = document.getElementById('analysisLoading');
      this.contentElement = document.getElementById('analysisContent');
      this.refreshButton = document.getElementById('refreshAnalysis');
      
      this.refreshButton.addEventListener('click', () => this.refreshAnalysis());
      
      // Load initial data
      this.loadAnalytics();
    }

    async loadAnalytics(forceRefresh = false) {
      try {
        this.showLoading();
        
        const url = `/brain-analytics/summary/${forceRefresh ? '?refresh=true' : ''}`;
        const response = await fetch(url, {
          credentials: 'same-origin',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        });
        
        const data = await response.json();
        
        if (data.error) {
          this.showError(data.message);
        } else {
          this.displayAnalytics(data);
        }
      } catch (error) {
        console.error('Analytics loading error:', error);
        this.showError('Analiz yüklenirken hata oluştu.');
      } finally {
        this.hideLoading();
      }
    }

    async refreshAnalysis() {
      this.refreshButton.disabled = true;
      this.refreshButton.textContent = 'Güncelleniyor...';
      
      await this.loadAnalytics(true);
      
      this.refreshButton.disabled = false;
      this.refreshButton.textContent = 'Güncelle';
    }

    displayAnalytics(data) {
      if (!data.has_sufficient_data) {
        this.showInsufficientData();
        return;
      }

      // Main score
      const score = data.brain_health_score;
      document.getElementById('brainHealthScore').textContent = score.toFixed(1);
      
      // Update progress circle
      this.updateProgressCircle(score);
      
      // Score breakdown
      this.updateScoreBreakdown(data.score_breakdown);
      
      // Exercise distribution
      this.updateExerciseDistribution(data.exercise_distribution);
      
      // Bonuses
      this.updateBonuses(data.bonuses);
      
      // Message
      this.updateMessage(score);
      
      // Show all sections
      document.getElementById('scoreBreakdown').classList.remove('hidden');
      document.getElementById('exerciseDistribution').classList.remove('hidden');
      document.getElementById('bonusInfo').classList.remove('hidden');
    }

    updateProgressCircle(score) {
      const circle = document.getElementById('progressCircle');
      const circumference = 351.86; // 2 * π * 56
      const offset = circumference - (score / 10) * circumference;
      circle.style.strokeDashoffset = offset;
    }

    updateScoreBreakdown(breakdown) {
      const metrics = ['frequency', 'performance', 'consistency', 'improvement'];
      
      metrics.forEach(metric => {
        const score = breakdown[metric] || 0;
        document.getElementById(`${metric}Score`).textContent = score.toFixed(1);
        document.getElementById(`${metric}Bar`).style.width = `${(score / 10) * 100}%`;
      });
    }

    updateExerciseDistribution(distribution) {
      // Use percentage values from backend
      const exercises = [
        { type: 'memory', element: 'memory' },
        { type: 'word_bridge', element: 'wordBridge' },
        { type: 'problem_chain', element: 'problemChain' }
      ];
      
      exercises.forEach(({ type, element }) => {
        const percentageKey = `${type}_percentage`;
        const percentage = distribution[percentageKey] || 0;
        
        document.getElementById(`${element}Bar`).style.width = `${percentage}%`;
        document.getElementById(`${element}Percent`).textContent = `${percentage}%`;
      });
    }

    updateBonuses(bonuses) {
      document.getElementById('varietyBonus').textContent = `+${bonuses.variety.toFixed(1)}`;
      document.getElementById('difficultyBonus').textContent = `+${bonuses.difficulty.toFixed(1)}`;
      document.getElementById('streakBonus').textContent = `+${bonuses.streak.toFixed(1)}`;
    }

    updateMessage(score) {
      let message = '';
      if (score >= 8.5) {
        message = 'Mükemmel! Beyin sağlığın çok iyi durumda.';
      } else if (score >= 7.0) {
        message = 'Harika! Düzenli egzersizlerin meyve veriyor.';
      } else if (score >= 5.5) {
        message = 'İyi gidiyorsun! Biraz daha düzenli ol.';
      } else if (score >= 3.0) {
        message = 'Başlangıç iyi! Egzersizleri artırabilirsin.';
      } else {
        message = 'Daha fazla egzersiz yaparak gelişebilirsin.';
      }
      
      document.getElementById('analysisMessage').textContent = message;
    }

    showInsufficientData() {
      document.getElementById('brainHealthScore').textContent = '-';
      document.getElementById('analysisMessage').textContent = 'En az 5 egzersiz tamamladıktan sonra analiz görüntülenecek.';
      
      // Hide optional sections
      document.getElementById('scoreBreakdown').classList.add('hidden');
      document.getElementById('exerciseDistribution').classList.add('hidden');
      document.getElementById('bonusInfo').classList.add('hidden');
    }

    showError(message) {
      document.getElementById('brainHealthScore').textContent = '!';
      document.getElementById('analysisMessage').textContent = message;
    }

    showLoading() {
      this.loadingElement.classList.remove('hidden');
      this.contentElement.style.opacity = '0.5';
    }

    hideLoading() {
      this.loadingElement.classList.add('hidden');
      this.contentElement.style.opacity = '1';
    }
  }

  // Initialize analytics when page loads
  document.addEventListener('DOMContentLoaded', () => {
    new BrainHealthAnalytics();
    
    // Modal functionality
    const modal = document.getElementById('analysisModal');
    const infoButton = document.getElementById('infoButton');
    const closeModal = document.getElementById('closeModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    
    // Open modal
    infoButton.addEventListener('click', () => {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Prevent background scroll
    });
    
    // Close modal functions
    const closeModalHandler = () => {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto'; // Restore scroll
    };
    
    closeModal.addEventListener('click', closeModalHandler);
    closeModalBtn.addEventListener('click', closeModalHandler);
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModalHandler();
      }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModalHandler();
      }
    });
  });

  // Günlük beyin sağlığı tavsiyesini yükle
async function loadDailyBrainTip() {
  try {
    const response = await fetch('/api/daily-brain-tip/', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`)
    }
    
    const result = await response.json()
    const tipContent = document.getElementById('daily-tip-content')
    
    if (result.success && result.data?.tip) {
      tipContent.innerHTML = `
        <div class="text-white leading-relaxed">
          ${result.data.tip}
          ${result.data.is_fallback ? '<div class="mt-2 text-sm text-yellow-300 flex items-center"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>Varsayılan tavsiye</div>' : ''}
        </div>
      `
    } else {
      throw new Error('Invalid response format')
    }
  } catch (error) {
    console.error('Günlük tavsiye yüklenirken hata:', error)
    const tipContent = document.getElementById('daily-tip-content')
    tipContent.innerHTML = `
      <div class="text-white leading-relaxed">
        Bugün aldığın önemli bir kararda, yapay zeka yardımı almadan önce kendi görüşünü not et.
        <div class="mt-2 text-sm text-red-300 flex items-center">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd"/>
          </svg>
          Bağlantı hatası
        </div>
      </div>
    `
  }
}

// Sayfa yüklendiğinde günlük tavsiyeyi yükle
document.addEventListener('DOMContentLoaded', loadDailyBrainTip)
</script>

{% include 'components/footer.html' %}
